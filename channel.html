<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Chaîne – Lumio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD5uZ2jt01wJVCWfjdJ6IFa5fAVbdfoI_c",
  authDomain: "lumio-6efed.firebaseapp.com",
  databaseURL: "https://lumio-6efed-default-rtdb.firebaseio.com",
  projectId: "lumio-6efed"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const params = new URLSearchParams(location.search);
const channelId = params.get("id");

if(!channelId){
  alert("Chaîne introuvable");
  location.href = "index.html";
}

async function loadChannel(){
  const snap = await get(ref(db, "channels/" + channelId));
  if(!snap.exists()) return;

  const ch = snap.val();
  channelName.textContent = ch.name;
  channelDesc.textContent = ch.description;
  avatar.src = ch.avatar;
  banner.src = ch.banner;
}

async function loadVideos(){
  const snap = await get(ref(db, "videosByChannel/" + channelId));
  if(!snap.exists()) return;

  for(const videoId in snap.val()){
    const vSnap = await get(ref(db, "videos/" + videoId));
    if(!vSnap.exists()) continue;
    const v = vSnap.val();

    const div = document.createElement("div");
    div.className = "video";
    div.innerHTML = `
      <img src="${v.thumbnail}">
      <h4>${v.title}</h4>
    `;
    div.onclick = ()=>location.href = "player.html?id=" + videoId;
    videos.appendChild(div);
  }
}

loadChannel();
loadVideos();
</script>

<style>
body{margin:0;background:#0f0f0f;color:white;font-family:system-ui}
.banner{width:100%;height:160px;object-fit:cover}
.avatar{width:80px;height:80px;border-radius:50%;margin-top:-40px;border:4px solid #0f0f0f}
.videos{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;padding:10px}
.video img{width:100%;border-radius:10px}
.video{cursor:pointer}
</style>
</head>

<body>
<img id="banner" class="banner">
<div style="padding:10px">
<img id="avatar" class="avatar">
<h2 id="channelName"></h2>
<p id="channelDesc"></p>
</div>

<div class="videos" id="videos"></div>
</body>
</html>
