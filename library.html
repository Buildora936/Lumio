<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Ma BibliothÃ¨que</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<style>
body{margin:0;background:#0f0f0f;color:white;font-family:system-ui}
header{padding:20px;font-size:22px;font-weight:600}
.grid{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
 gap:16px;
 padding:16px
}
.card{
 background:#1c1c1c;
 border-radius:14px;
 overflow:hidden;
 cursor:pointer;
 transition:.2s;
}
.card:hover{transform:scale(1.03)}
.cover{
 height:200px;
 background:#222;
 background-size:cover;
 background-position:center
}
.info{padding:12px}
.title{font-weight:600;margin-bottom:6px}
.author{color:#aaa;font-size:13px}
.empty{
 text-align:center;
 margin-top:60px;
 color:#aaa;
 font-size:18px
}
</style>
</head>
<body>

<header>ðŸ“š Ma BibliothÃ¨que</header>

<div id="grid" class="grid"></div>
<div id="empty" class="empty" style="display:none;">Aucun livre achetÃ©</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getDatabase,ref,get } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const app=initializeApp({
 apiKey:"AIzaSyD5uZ2jt01wJVCWfjdJ6IFa5fAVbdfoI_c",
 authDomain:"lumio-6efed.firebaseapp.com",
 databaseURL:"https://lumio-6efed-default-rtdb.firebaseio.com",
 projectId:"lumio-6efed"
});

const auth=getAuth(app);
const db=getDatabase(app);

const grid=document.getElementById("grid");
const empty=document.getElementById("empty");

onAuthStateChanged(auth,async user=>{
 if(!user){
  location.href="auth.html";
  return;
 }

 const purchasesSnap=await get(ref(db,"purchases/"+user.uid));

 if(!purchasesSnap.exists()){
  empty.style.display="block";
  return;
 }

 const purchases=purchasesSnap.val();
 const booksSnap=await get(ref(db,"books"));
 const books=booksSnap.exists()?booksSnap.val():{};

 let count=0;

 Object.keys(purchases).forEach(id=>{
  const b=books[id];
  if(!b) return;

  count++;

  const card=document.createElement("div");
  card.className="card";
  card.onclick=()=>location.href="reader.html?id="+id;

  card.innerHTML=`
   <div class="cover" style="background-image:url('${b.coverBase64||""}')"></div>
   <div class="info">
    <div class="title">${b.title}</div>
    <div class="author">${b.authorChannelName||"Auteur"}</div>
   </div>
  `;

  grid.appendChild(card);
 });

 if(count===0) empty.style.display="block";
});
</script>

</body>
</html>
