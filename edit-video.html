<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Éditer la vidéo – Lumio Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#181818">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}
body{background:#181818;color:white}

/* HEADER */
header{
  position:fixed;top:0;left:0;right:0;height:56px;
  background:#0f0f0f;display:flex;align-items:center;
  justify-content:space-between;padding:0 12px;z-index:100
}
.left{display:flex;align-items:center;gap:10px}
.left img{width:32px}
.right button{
  background:#202020;color:white;
  border:none;padding:8px 14px;
  border-radius:20px;cursor:pointer
}

/* LAYOUT */
.main{margin-top:56px;padding:16px;max-width:900px;margin-inline:auto}

/* CARD */
.card{
  background:#202020;
  border-radius:18px;
  padding:16px;
  border:1px solid #262626;
  margin-bottom:16px
}
.card h3{margin-bottom:10px}

/* FORM */
input,textarea,select{
  width:100%;background:#181818;
  border:1px solid #333;
  color:white;padding:12px;
  border-radius:12px;
  margin-bottom:12px
}
textarea{min-height:100px;resize:none}

/* THUMB */
.thumb-preview{
  width:100%;height:200px;
  background:#2a2a2a;
  border-radius:14px;
  background-size:cover;
  background-position:center;
  margin-bottom:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#aaa;
  font-size:14px
}

/* TOGGLES */
.toggle{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px
}
.toggle input{width:auto}

/* ACTIONS */
.actions{
  display:flex;
  gap:10px;
  margin-top:16px
}
.actions button{
  flex:1;
  padding:12px;
  border-radius:20px;
  border:none;
  font-weight:700;
  cursor:pointer
}
.save{background:#ff9800;color:black}
.delete{background:#f44336;color:white}

/* SKELETON */
.skeleton{animation:pulse 1.2s infinite}
@keyframes pulse{
  0%{opacity:.6}
  50%{opacity:.3}
  100%{opacity:.6}
}
</style>
</head>

<body>

<header>
  <div class="left">
    <img src="logo_lumio.png">
    <strong>Éditer la vidéo</strong>
  </div>
  <div class="right">
    <button onclick="history.back()"><i class="fa fa-arrow-left"></i></button>
  </div>
</header>

<div class="main">

  <!-- THUMB -->
  <div class="card">
    <div class="thumb-preview" id="thumb">Miniature</div>
    <input type="file" id="thumbInput" accept="image/*">
  </div>

  <!-- INFOS -->
  <div class="card">
    <h3>Informations</h3>
    <input id="title" placeholder="Titre de la vidéo">
    <textarea id="description" placeholder="Description"></textarea>
    <select id="category">
      <option value="video">Vidéo</option>
      <option value="MV">MV</option>
      <option value="live">Live</option>
    </select>
  </div>

  <!-- OPTIONS -->
  <div class="card">
    <h3>Options</h3>

    <div class="toggle">
      <span>Visibilité publique</span>
      <input type="checkbox" id="public">
    </div>

    <div class="toggle">
      <span>Monétisation</span>
      <input type="checkbox" id="monetized">
    </div>

    <div class="toggle">
      <span>Commentaires</span>
      <input type="checkbox" id="comments">
    </div>
  </div>

  <!-- ACTIONS -->
  <div class="actions">
    <button class="save" onclick="save()">Enregistrer</button>
    <button class="delete" onclick="remove()">Supprimer</button>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getDatabase,ref,get,update,remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const app=initializeApp({
  apiKey:"AIzaSyD5uZ2jt01wJVCWfjdJ6IFa5fAVbdfoI_c",
  authDomain:"lumio-6efed.firebaseapp.com",
  databaseURL:"https://lumio-6efed-default-rtdb.firebaseio.com",
  projectId:"lumio-6efed"
});
const auth=getAuth(app);
const db=getDatabase(app);

const params=new URLSearchParams(location.search);
const videoId=params.get("id");

const titleInput=document.getElementById("title");
const descInput=document.getElementById("description");
const categoryInput=document.getElementById("category");
const pubInput=document.getElementById("public");
const monetInput=document.getElementById("monetized");
const comInput=document.getElementById("comments");
const thumb=document.getElementById("thumb");

/* AUTH + LOAD */
onAuthStateChanged(auth,async user=>{
  if(!user){location.href="auth.html";return}

  const snap=await get(ref(db,"videos/"+videoId));
  if(!snap.exists()) return;

  const v=snap.val();
  titleInput.value=v.title||"";
  descInput.value=v.description||"";
  categoryInput.value=v.category||"video";
  pubInput.checked=v.public!==false;
  monetInput.checked=!!v.monetized;
  comInput.checked=v.comments!==false;
  if(v.thumbnailBase64){
    thumb.style.backgroundImage=`url(${v.thumbnailBase64})`;
    thumb.textContent="";
  }
});

/* SAVE */
window.save=async ()=>{
  await update(ref(db,"videos/"+videoId),{
    title:titleInput.value,
    description:descInput.value,
    category:categoryInput.value,
    public:pubInput.checked,
    monetized:monetInput.checked,
    comments:comInput.checked,
    updatedAt:Date.now()
  });
  alert("Vidéo mise à jour");
};

/* DELETE */
window.remove=async ()=>{
  if(!confirm("Supprimer cette vidéo ?")) return;
  await remove(ref(db,"videos/"+videoId));
  location.href="studio.html";
};
</script>

</body>
</html>
