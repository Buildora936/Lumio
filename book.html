<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Lecture</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<style>
body{
 margin:0;
 background:#1a1a1a;
 font-family:serif;
 color:#111;
 display:flex;
 flex-direction:column;
 align-items:center;
}

/* barre top */
.topbar{
 width:100%;
 padding:14px;
 color:white;
 text-align:center;
 font-weight:600;
}

/* livre */
.book{
 width:90%;
 max-width:700px;
 height:80vh;
 background:#fdf6e3;
 border-radius:12px;
 box-shadow:0 10px 40px rgba(0,0,0,.6);
 padding:40px;
 box-sizing:border-box;
 position:relative;
 overflow:hidden;
}

/* page */
.page{
 width:100%;
 height:100%;
 overflow:auto;
 font-size:18px;
 line-height:1.7;
}

/* animation flip */
.flip{
 animation:flip .35s ease;
}
@keyframes flip{
 from{transform:rotateY(90deg);opacity:.3}
 to{transform:rotateY(0);opacity:1}
}

/* nav */
.nav{
 display:flex;
 justify-content:space-between;
 width:90%;
 max-width:700px;
 margin-top:12px;
}
.btn{
 background:#2c2c2c;
 color:white;
 border:none;
 padding:10px 18px;
 border-radius:8px;
 cursor:pointer;
}
.btn:disabled{opacity:.3}

/* page index */
.counter{
 position:absolute;
 bottom:12px;
 right:20px;
 font-size:14px;
 color:#666;
}
</style>
</head>
<body>

<div class="topbar" id="title">Livre</div>

<div class="book" id="book">
  <div class="page" id="page"></div>
  <div class="counter" id="counter"></div>
</div>

<div class="nav">
  <button class="btn" id="prev">← Précédent</button>
  <button class="btn" id="next">Suivant →</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase,ref,get } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const app=initializeApp({
 apiKey:"AIzaSyD5uZ2jt01wJVCWfjdJ6IFa5fAVbdfoI_c",
 authDomain:"lumio-6efed.firebaseapp.com",
 databaseURL:"https://lumio-6efed-default-rtdb.firebaseio.com",
 projectId:"lumio-6efed"
});

const db=getDatabase(app);

const url=new URLSearchParams(location.search);
const id=url.get("id");

const pageEl=document.getElementById("page");
const counter=document.getElementById("counter");
const title=document.getElementById("title");

let pages=[];
let index=0;

/* load book */
const snap=await get(ref(db,"books/"+id));
if(!snap.exists()){
 pageEl.innerHTML="Livre introuvable";
 throw "";
}

const book=snap.val();
title.innerText=book.title||"Livre";

pages=book.pages||["Livre vide"];

/* render */
function render(){
 pageEl.classList.remove("flip");
 void pageEl.offsetWidth;
 pageEl.classList.add("flip");

 pageEl.innerHTML=pages[index];
 counter.innerText=`${index+1} / ${pages.length}`;

 prev.disabled=index===0;
 next.disabled=index===pages.length-1;
}

const prev=document.getElementById("prev");
const next=document.getElementById("next");

prev.onclick=()=>{if(index>0){index--;render();}}
next.onclick=()=>{if(index<pages.length-1){index++;render();}}

/* swipe mobile */
let startX=0;

document.getElementById("book").addEventListener("touchstart",e=>{
 startX=e.touches[0].clientX;
});

document.getElementById("book").addEventListener("touchend",e=>{
 const endX=e.changedTouches[0].clientX;
 const diff=endX-startX;

 if(Math.abs(diff)<40) return;

 if(diff<0 && index<pages.length-1){
  index++;
  render();
}
 else if(diff>0 && index>0){
  index--;
  render();
}
});

render();
</script>
</body>
</html>
