<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Publier un livre â€“ Lumio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

const app = initializeApp({
  apiKey: "AIzaSyD5uZ2jt01wJVCWfjdJ6IFa5fAVbdfoI_c",
  databaseURL: "https://lumio-6efed-default-rtdb.firebaseio.com"
});

const db = getDatabase(app);
const auth = getAuth(app);

const coverInput = document.getElementById("cover");
const fileInput = document.getElementById("file");

function toBase64(file, cb){
  const r = new FileReader();
  r.onload = () => cb(r.result);
  r.readAsDataURL(file);
}

document.getElementById("publish").onclick = ()=>{
  const u = auth.currentUser;
  if(!u) return alert("Connexion requise");

  toBase64(coverInput.files[0], cover=>{
    toBase64(fileInput.files[0], file=>{
      push(ref(db,"books"),{
        title:title.value,
        description:desc.value,
        coverBase64:cover,
        fileBase64:file,
        price:0.99,
        authorId:u.uid,
        authorName:u.displayName || "Auteur",
        createdAt:Date.now()
      }).then(()=>alert("Livre publiÃ©"));
    });
  });
};
</script>

<style>
body{background:#181818;color:white;font-family:system-ui;padding:16px}
input,textarea{width:100%;margin-bottom:12px;padding:10px}
button{background:#ff7f50;border:none;padding:12px;border-radius:20px}
</style>
</head>

<body>
<h2>ðŸ“˜ Publier un livre</h2>
<input id="title" placeholder="Titre">
<textarea id="desc" placeholder="Description"></textarea>
<input id="cover" type="file" accept="image/*">
<input id="file" type="file" accept="application/pdf">
<button id="publish">Publier</button>
</body>
</html>
