<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Lumio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#181818">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui;color:white;}
body{background:#181818;}
/* ================= HEADER ================= */
header{
  position:fixed;top:0;left:0;right:0;height:56px;background:#0f0f0f;display:flex;align-items:center;justify-content:space-between;padding:0 12px;z-index:100;
}
header .left{display:flex;align-items:center;gap:10px;}
header .left img{width:34px;}
header .center{flex:1;display:flex;justify-content:center;}
header .center input{width:420px;max-width:60vw;padding:8px 16px;border-radius:20px;border:none;background:#202020;color:white;}
header .right{display:flex;gap:10px;}
header button{background:#202020;color:white;border:none;padding:8px 12px;border-radius:20px;cursor:pointer;}
/* ================= LAYOUT ================= */
.layout{display:flex;margin-top:56px;}
/* ================= SIDEBAR ================= */
.sidebar{width:80px;background:#0f0f0f;display:flex;flex-direction:column;align-items:center;}
.sidebar a,.sidebar button{width:100%;padding:12px 0;background:none;border:none;color:#aaa;text-decoration:none;font-size:11px;display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;}
.sidebar i{font-size:20px}
.sidebar a:hover,.sidebar button:hover{background:#1f1f1f;color:white;}
/* ================= MORE MENU ================= */
.more-menu{position:fixed;left:80px;top:56px;width:140px;background:#111;display:none;flex-direction:column;}
.more-menu.open{display:flex}
.more-menu a{padding:12px;color:#aaa;text-decoration:none;}
.more-menu a:hover{background:#222;color:white;}
/* ================= CONTENT ================= */
.content{flex:1;padding:16px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;}
.card{background:#181818;border-radius:16px;padding:14px;border:1px solid #262626;display:flex;flex-direction:column;gap:10px;}
.card img{width:100%;height:140px;border-radius:12px;object-fit:cover;}
.card h3{margin:0;font-size:16px;}
.card p{margin:0;font-size:12px;color:#aaa;}
.card .install-btn{margin-top:6px;padding:8px;background:#ff6a00;color:black;border:none;border-radius:14px;font-weight:700;cursor:pointer;text-align:center;}
/* ================= MOBILE / TABLET ================= */
@media (max-width:900px){
  .layout{flex-direction:column;margin-bottom:56px;}
  .sidebar{position:fixed;bottom:0;left:0;width:100%;height:56px;flex-direction:row;justify-content:space-around;z-index:100;}
  .sidebar a,.sidebar button{font-size:10px;}
  header .center{display:none;}
  #searchBtn{display:inline-flex;}
}
/* ================= LOADER ================= */
#loader{position:fixed;inset:0;background:#181818;display:flex;justify-content:center;align-items:center;z-index:200;}
.loader{width:50px;height:50px;border:6px solid #333;border-top:6px solid #ff8800;border-radius:50%;animation:spin 1s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div id="loader"><div class="loader"></div></div>

<header>
  <div class="left">
    <img src="logo_lumio.png">
    <strong>Lumio</strong>
  </div>
  <div class="center">
    <input id="searchInput" placeholder="Rechercher sur Lumio">
  </div>
  <div class="right">
    <button id="searchBtn" style="display:none" onclick="location.href='search.html'"><i class="fa fa-search"></i></button>
    <button id="notifBtn" style="display:none" onclick="location.href='notification.html'"><i class="fa fa-bell"></i></button>
    <button id="uploadBtn" style="display:none" onclick="location.href='publish.html'"><i class="fa fa-plus"></i></button>
    <button id="startBtn" onclick="location.href='auth.html'">Commencer</button>
    <button id="profileBtn" style="display:none" onclick="location.href='profile.html'"><i class="fa fa-user"></i></button>
  </div>
</header>

<div class="layout">
<nav class="sidebar">
  <a href="index.html"><i class="fa fa-house"></i><span>Accueil</span></a>
  <a href="trending.html"><i class="fa fa-fire"></i><span>Tendance</span></a>
  <a href="shorts.html"><i class="fa fa-bolt"></i><span>MV</span></a>
  <a href="subscriptions.html"><i class="fa fa-tv"></i><span>Subs</span></a>
  <a href="library.html"><i class="fa fa-folder"></i><span>Bibli</span></a>
  <button onclick="toggleMoreMenu()"><i class="fa fa-ellipsis"></i><span>Plus</span></button>
</nav>

<div class="more-menu" id="moreMenu">                                    
  <a href="help.html">üîî Centre d'aide</a>                                    
  <a href="profile.html">üë§ Profil</a>                                    
  <a href="studio.html">üé¨ Studio</a>                                    
  <a href="analytics.html">üìä Analytics</a>                                    
  <a href="monetization.html">üí∞ Mon√©tisation</a>                                    
  <a href="settings.html">‚öôÔ∏è Param√®tres</a>                                    
  <a href="privacy.html">üîê Confidentialit√©</a>                                    
  <a href="security.html">üõ°Ô∏è S√©curit√©</a>                                    
  <a href="copyright.html">¬© Copyright</a>                                    
</div>

<main class="content">
  <div class="grid" id="grid"></div>
</main>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyB5BDmDEAhYthXogNEV2MalFL0fno7G_l8",
  authDomain: "averon-store.firebaseapp.com",
  projectId: "averon-store",
  appId: "1:405353616020:web:5c1b7dd2dca374a4119a81"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const loader = document.getElementById("loader");
setTimeout(()=>loader.style.display="none",3000);

const grid = document.getElementById("grid");

function toggleMoreMenu(){document.getElementById("moreMenu").classList.toggle("open");}

// Affichage boutons apr√®s login
onAuthStateChanged(auth,user=>{
  if(user){
    document.getElementById("startBtn").style.display="none";
    document.getElementById("notifBtn").style.display="inline-flex";
    document.getElementById("uploadBtn").style.display="inline-flex";
    document.getElementById("profileBtn").style.display="inline-flex";
  }
});

// Charger vid√©os et ins√©rer pubs
const videoRef = ref(db,"videos");
onValue(videoRef,snap=>{
  grid.innerHTML="";
  let count = 0;
  if(snap.exists()){
    Object.values(snap.val()).forEach(v=>{
      count++;
      // Pub Adsterra avant la premi√®re vid√©o et apr√®s chaque 6 vid√©os
      if(count === 1 || count % 6 === 0){
        const adCard = document.createElement("div");
        adCard.className="card";
        adCard.innerHTML=`<script>
          atOptions = {
            'key' : '34ced6a9c342f10844eedf343e137cfb',
            'format' : 'iframe',
            'height' : 250,
            'width' : 300,
            'params' : {}
          };
        </script>
        <script src="https://www.highperformanceformat.com/34ced6a9c342f10844eedf343e137cfb/invoke.js"></script>`;
        grid.appendChild(adCard);
      }
      const card = document.createElement("div");
      card.className="card";
      card.innerHTML=`<img src="${v.thumbnail}" alt="${v.title}">
                        <h3>${v.title}</h3>
                        <p>${v.description}</p>
                        <button class="install-btn" onclick="location.href='watch.html?id=${v.id}'">Voir</button>`;
      grid.appendChild(card);
    });
  }else{
    grid.innerHTML="<p style='color:#aaa'>Aucune vid√©o disponible.</p>";
  }
});
</script>

<link rel="manifest" href="manifest.json">
<script>
if("serviceWorker"in navigator){navigator.serviceWorker.register("service-worker.js");}
</script>

</body>
</html>
