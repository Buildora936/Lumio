<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Lumio Studio – Analytics</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- Chart.js pour graphiques -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD5uZ2jt01wJVCWfjdJ6IFa5fAVbdfoI_c",
  authDomain: "lumio-6efed.firebaseapp.com",
  databaseURL: "https://lumio-6efed-default-rtdb.firebaseio.com",
  projectId: "lumio-6efed"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUserId = null;

// UI Elements
const totalViewsEl = document.getElementById("totalViews");
const totalLikesEl = document.getElementById("totalLikes");
const totalCommentsEl = document.getElementById("totalComments");
const revenueEl = document.getElementById("revenue");
const chartCanvas = document.getElementById("viewsChart").getContext("2d");

onAuthStateChanged(auth, user => {
  if(user){
    currentUserId = user.uid;
    loadAnalytics();
  } else {
    alert("Vous devez être connecté pour accéder à Analytics");
    location.href = "auth.html";
  }
});

function loadAnalytics(){
  onValue(ref(db, "videos"), snap => {
    if(!snap.exists()) return;

    let totalViews = 0, totalLikes = 0, totalComments = 0;
    let labels = [], data = [];

    Object.entries(snap.val())
      .filter(([id, v]) => v.creatorId === currentUserId)
      .forEach(([id, v]) => {
        totalViews += v.views || 0;
        totalLikes += v.likes || 0;
        totalComments += v.commentsCount || 0;

        labels.push(v.title);
        data.push(v.views || 0);
      });

    totalViewsEl.textContent = totalViews;
    totalLikesEl.textContent = totalLikes;
    totalCommentsEl.textContent = totalComments;
    revenueEl.textContent = `$${(totalViews*0.01).toFixed(2)}`; // Exemple 1 cent / vue

    // Graphique
    new Chart(chartCanvas, {
      type: "bar",
      data: {
        labels: labels,
        datasets: [{
          label: "Vues",
          data: data,
          backgroundColor: "#f90"
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  });
}
</script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:#181818;
  color:white;
}
header{
  position:fixed;top:0;left:0;right:0;height:56px;background:#0f0f0f;
  display:flex;align-items:center;justify-content:space-between;padding:0 16px;z-index:10;
}
header h1{font-size:20px;font-weight:600}
header .right{display:flex;gap:10px;align-items:center}
button{background:#202020;color:white;border:none;padding:8px 14px;border-radius:20px;cursor:pointer}
button:hover{background:#333}

/* CONTENT */
.content{margin-top:56px;padding:16px}
.stats{display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap}
.stat{background:#202020;padding:16px;border-radius:12px;flex:1;min-width:150px;text-align:center}
.stat h3{margin:0 0 6px 0;font-size:14px;color:#aaa}
.stat p{margin:0;font-size:18px;font-weight:600;color:#f90}

/* CHART */
.chart-container{background:#202020;padding:16px;border-radius:12px}
</style>
</head>

<body>

<header>
  <h1>Lumio Analytics</h1>
  <div class="right">
    <button onclick="location.href='studio.html'"><i class="fa-solid fa-arrow-left"></i> Studio</button>
  </div>
</header>

<main class="content">
  <div class="stats">
    <div class="stat">
      <h3>Total Vues</h3>
      <p id="totalViews">0</p>
    </div>
    <div class="stat">
      <h3>Total Likes</h3>
      <p id="totalLikes">0</p>
    </div>
    <div class="stat">
      <h3>Total Commentaires</h3>
      <p id="totalComments">0</p>
    </div>
    <div class="stat">
      <h3>Revenu Estimé</h3>
      <p id="revenue">$0.00</p>
    </div>
  </div>

  <div class="chart-container">
    <canvas id="viewsChart"></canvas>
  </div>
</main>

</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Lumio Studio – Analytics</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- Chart.js pour graphiques -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD5uZ2jt01wJVCWfjdJ6IFa5fAVbdfoI_c",
  authDomain: "lumio-6efed.firebaseapp.com",
  databaseURL: "https://lumio-6efed-default-rtdb.firebaseio.com",
  projectId: "lumio-6efed"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUserId = null;

// UI Elements
const totalViewsEl = document.getElementById("totalViews");
const totalLikesEl = document.getElementById("totalLikes");
const totalCommentsEl = document.getElementById("totalComments");
const revenueEl = document.getElementById("revenue");
const chartCanvas = document.getElementById("viewsChart").getContext("2d");

onAuthStateChanged(auth, user => {
  if(user){
    currentUserId = user.uid;
    loadAnalytics();
  } else {
    alert("Vous devez être connecté pour accéder à Analytics");
    location.href = "auth.html";
  }
});

function loadAnalytics(){
  onValue(ref(db, "videos"), snap => {
    if(!snap.exists()) return;

    let totalViews = 0, totalLikes = 0, totalComments = 0;
    let labels = [], data = [];

    Object.entries(snap.val())
      .filter(([id, v]) => v.creatorId === currentUserId)
      .forEach(([id, v]) => {
        totalViews += v.views || 0;
        totalLikes += v.likes || 0;
        totalComments += v.commentsCount || 0;

        labels.push(v.title);
        data.push(v.views || 0);
      });

    totalViewsEl.textContent = totalViews;
    totalLikesEl.textContent = totalLikes;
    totalCommentsEl.textContent = totalComments;
    revenueEl.textContent = `$${(totalViews*0.01).toFixed(2)}`; // Exemple 1 cent / vue

    // Graphique
    new Chart(chartCanvas, {
      type: "bar",
      data: {
        labels: labels,
        datasets: [{
          label: "Vues",
          data: data,
          backgroundColor: "#f90"
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  });
}
</script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:#181818;
  color:white;
}
header{
  position:fixed;top:0;left:0;right:0;height:56px;background:#0f0f0f;
  display:flex;align-items:center;justify-content:space-between;padding:0 16px;z-index:10;
}
header h1{font-size:20px;font-weight:600}
header .right{display:flex;gap:10px;align-items:center}
button{background:#202020;color:white;border:none;padding:8px 14px;border-radius:20px;cursor:pointer}
button:hover{background:#333}

/* CONTENT */
.content{margin-top:56px;padding:16px}
.stats{display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap}
.stat{background:#202020;padding:16px;border-radius:12px;flex:1;min-width:150px;text-align:center}
.stat h3{margin:0 0 6px 0;font-size:14px;color:#aaa}
.stat p{margin:0;font-size:18px;font-weight:600;color:#f90}

/* CHART */
.chart-container{background:#202020;padding:16px;border-radius:12px}
</style>
</head>

<body>

<header>
  <h1>Lumio Analytics</h1>
  <div class="right">
    <button onclick="location.href='studio.html'"><i class="fa-solid fa-arrow-left"></i> Studio</button>
  </div>
</header>

<main class="content">
  <div class="stats">
    <div class="stat">
      <h3>Total Vues</h3>
      <p id="totalViews">0</p>
    </div>
    <div class="stat">
      <h3>Total Likes</h3>
      <p id="totalLikes">0</p>
    </div>
    <div class="stat">
      <h3>Total Commentaires</h3>
      <p id="totalComments">0</p>
    </div>
    <div class="stat">
      <h3>Revenu Estimé</h3>
      <p id="revenue">$0.00</p>
    </div>
  </div>

  <div class="chart-container">
    <canvas id="viewsChart"></canvas>
  </div>
</main>

</body>
</html>
