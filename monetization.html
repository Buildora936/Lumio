<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mon√©tisation ‚Äì Lumio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD5uZ2jt01wJVCWfjdJ6IFa5fAVbdfoI_c",
  authDomain: "lumio-6efed.firebaseapp.com",
  databaseURL: "https://lumio-6efed-default-rtdb.firebaseio.com",
  projectId: "lumio-6efed"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let channelId = null;

onAuthStateChanged(auth, async user => {
  if (!user) return location.href = "auth.html";

  const chSnap = await get(ref(db, "userChannels/" + user.uid));
  if (!chSnap.exists()) {
    alert("Cr√©ez une cha√Æne d'abord");
    return location.href = "add-channel.html";
  }
  channelId = chSnap.val();

  // V√©rifier abonn√©s
  const subSnap = await get(ref(db, "subscriptions/" + channelId));
  const subs = subSnap.exists()
    ? Object.keys(subSnap.val()).length
    : 0;

  document.getElementById("subs").textContent = subs;

  if (subs < 1000) {
    document.getElementById("blocked").style.display = "block";
    document.getElementById("panel").style.display = "none";
    return;
  }

  // Charger config existante
  const mSnap = await get(ref(db, "monetization/" + channelId));
  if (mSnap.exists()) {
    const m = mSnap.val();
    ads.checked = m.ads;
    donations.checked = m.donations;
  }
});

saveBtn.onclick = async () => {
  await set(ref(db, "monetization/" + channelId), {
    enabled: true,
    ads: ads.checked,
    donations: donations.checked,
    live: false,
    createdAt: Date.now()
  });
  alert("Mon√©tisation enregistr√©e ‚úÖ");
};
</script>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#181818;
  color:white;
}
header{
  height:56px;
  background:#0f0f0f;
  display:flex;
  align-items:center;
  padding:0 16px;
}
main{
  max-width:700px;
  margin:24px auto;
  padding:16px;
}
.box{
  background:#202020;
  border-radius:14px;
  padding:20px;
}
.option{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:14px 0;
}
button{
  width:100%;
  margin-top:20px;
  padding:14px;
  background:#ff6a00;
  border:none;
  border-radius:20px;
  font-weight:700;
  cursor:pointer;
}
.notice{
  background:#2a2a2a;
  padding:14px;
  border-radius:14px;
  margin-bottom:16px;
  font-size:14px;
}
.blocked{
  background:#331111;
  padding:16px;
  border-radius:14px;
}
</style>
</head>

<body>

<header>
  <i class="fa-solid fa-arrow-left"
     onclick="history.back()"></i>
  <h3 style="margin-left:12px">Mon√©tisation</h3>
</header>

<main>

  <div class="notice">
    üë• Abonn√©s actuels : <b id="subs">0</b> / 1000 requis
  </div>

  <div id="blocked" class="blocked" style="display:none">
    ‚ùå Vous devez atteindre <b>1000 abonn√©s</b> pour activer la mon√©tisation.
  </div>

  <div id="panel" class="box">
    <h3>Options disponibles</h3>

    <div class="option">
      <span>üü† Publicit√© l√©g√®re (5s max)</span>
      <input type="checkbox" id="ads">
    </div>

    <div class="option">
      <span>üîµ Dons / Soutien ‚ù§Ô∏è</span>
      <input type="checkbox" id="donations">
    </div>

    <button id="saveBtn">
      Enregistrer la mon√©tisation
    </button>
  </div>
<div><button id="saveBtn">
      demander un enlevement
    </button></div>
</main>

</body>
</html>
